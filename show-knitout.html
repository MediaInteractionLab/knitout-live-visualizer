<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Test of knitout visualizer (2)</title>

<style>
code.knitout {
	display:block;
	height:10em;
	overflow:auto;
	background:#eee;
	border-radius:5px;
}
#dropTarget {
	position:fixed;
	left:0;
	bottom:0;
	width:100%;
	height:100%;

	background:#ccc;
	outline:4px dashed #eee;
	outline-offset:-20px;
	z-index:100;
	visibility:hidden;
}
#dropTarget.active {
	visibility:visible;
	background:#eee;
	outline-color:#ccc;
}
#file {
	display:none;
}
#fileLabel span {
	cursor:pointer;
	text-decoration:underline;
}

#show1 {
        margin: 1em;
	width:100vh;
	height:80vh;
        float: left;
        box-sizing: border-box;
}

#code1 {
        box-sizing: border-box;
        margin: 1em;
        padding: 1em;
        padding-right: 2em;
        background-color: #f3f3f3;
        float: left;
        height: 80vh;
        overflow: scroll;
        line-height: 1.2;
}

.lineNumber {
        color: #888;
        width: 2.5em;
        display: inline-block;
        text-align: right;
        margin-right: 1em;
}

.spinning {
        border: 4px solid #f3f3f3; /* Light grey */
        border-top: 4px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 1em;
        height: 1em;
        animation: spin 2s linear infinite;
        display: inline-block;
}

@keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
}

</style>

</head>
<body>
    <div>
        <input id="file" type="file" />
    </div>
<label id="fileLabel" for="file"><span>Choose a knitout file</span> or drag one into the window to visualize it. <span id="spinner" class="spinning" style="visibility: hidden;"></span></label>

<p>Here's some example knitout code:</p>

<canvas class="ShowKnitout" id="show1" data-code="code1"></canvas>
<pre><code class="Knitout" id="code1">;!knitout-2
;;Carriers: A B C
; generated by write-test.js

; tuck +
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
tuck + f0
tuck + f1
tuck + f2
tuck + f3
drop f0
drop f1
drop f2
drop f3
outhook A B C

; tuck -
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
tuck - f3
tuck - f2
tuck - f1
tuck - f0
drop f0
drop f1
drop f2
drop f3
outhook A B C

; tuck + A
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
tuck + f0 A
tuck + f1 A
tuck + f2 A
tuck + f3 A
drop f0
drop f1
drop f2
drop f3
outhook A B C

; tuck - A
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
tuck - f3 A
tuck - f2 A
tuck - f1 A
tuck - f0 A
drop f0
drop f1
drop f2
drop f3
outhook A B C

; tuck + A B
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
tuck + f0 A B
tuck + f1 A B
tuck + f2 A B
tuck + f3 A B
drop f0
drop f1
drop f2
drop f3
outhook A B C

; tuck - A B
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
tuck - f3 A B
tuck - f2 A B
tuck - f1 A B
tuck - f0 A B
drop f0
drop f1
drop f2
drop f3
outhook A B C

; tuck + A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
tuck + f0 A B C
tuck + f1 A B C
tuck + f2 A B C
tuck + f3 A B C
drop f0
drop f1
drop f2
drop f3
outhook A B C

; tuck - A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
tuck - f3 A B C
tuck - f2 A B C
tuck - f1 A B C
tuck - f0 A B C
drop f0
drop f1
drop f2
drop f3
outhook A B C

; knit +
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
knit + f0
knit + f1
knit + f2
knit + f3
drop f0
drop f1
drop f2
drop f3
outhook A B C

; knit -
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
knit - f3
knit - f2
knit - f1
knit - f0
drop f0
drop f1
drop f2
drop f3
outhook A B C

; knit + A
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
knit + f0 A
knit + f1 A
knit + f2 A
knit + f3 A
drop f0
drop f1
drop f2
drop f3
outhook A B C

; knit - A
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
knit - f3 A
knit - f2 A
knit - f1 A
knit - f0 A
drop f0
drop f1
drop f2
drop f3
outhook A B C

; knit + A B
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
knit + f0 A B
knit + f1 A B
knit + f2 A B
knit + f3 A B
drop f0
drop f1
drop f2
drop f3
outhook A B C

; knit - A B
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
knit - f3 A B
knit - f2 A B
knit - f1 A B
knit - f0 A B
drop f0
drop f1
drop f2
drop f3
outhook A B C

; knit + A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
knit + f0 A B C
knit + f1 A B C
knit + f2 A B C
knit + f3 A B C
drop f0
drop f1
drop f2
drop f3
outhook A B C

; knit - A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
knit - f3 A B C
knit - f2 A B C
knit - f1 A B C
knit - f0 A B C
drop f0
drop f1
drop f2
drop f3
outhook A B C

; miss +
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
miss + f0
miss + f1
miss + f2
miss + f3
drop f0
drop f1
drop f2
drop f3
outhook A B C

; miss -
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
miss - f3
miss - f2
miss - f1
miss - f0
drop f0
drop f1
drop f2
drop f3
outhook A B C

; miss + A
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
miss + f0 A
miss + f1 A
miss + f2 A
miss + f3 A
drop f0
drop f1
drop f2
drop f3
outhook A B C

; miss - A
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
miss - f3 A
miss - f2 A
miss - f1 A
miss - f0 A
drop f0
drop f1
drop f2
drop f3
outhook A B C

; miss + A B
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
miss + f0 A B
miss + f1 A B
miss + f2 A B
miss + f3 A B
drop f0
drop f1
drop f2
drop f3
outhook A B C

; miss - A B
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
miss - f3 A B
miss - f2 A B
miss - f1 A B
miss - f0 A B
drop f0
drop f1
drop f2
drop f3
outhook A B C

; miss + A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
miss + f0 A B C
miss + f1 A B C
miss + f2 A B C
miss + f3 A B C
drop f0
drop f1
drop f2
drop f3
outhook A B C

; miss - A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
miss - f3 A B C
miss - f2 A B C
miss - f1 A B C
miss - f0 A B C
drop f0
drop f1
drop f2
drop f3
outhook A B C


; split +  over
inhook A B C
tuck - b3
tuck - b2
tuck - b1
tuck - b0
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0
split + f1 b1
split + f2 b2
split + f3 b3
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C


; split -  over
inhook A B C
tuck + b0
tuck + b1
tuck + b2
tuck + b3
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3
split - f2 b2
split - f1 b1
split - f0 b0
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split + A over
inhook A B C
tuck - b3
tuck - b2
tuck - b1
tuck - b0
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0 A
split + f1 b1 A
split + f2 b2 A
split + f3 b3 A
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split - A over
inhook A B C
tuck + b0
tuck + b1
tuck + b2
tuck + b3
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3 A
split - f2 b2 A
split - f1 b1 A
split - f0 b0 A
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split + A B over
inhook A B C
tuck - b3
tuck - b2
tuck - b1
tuck - b0
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0 A B
split + f1 b1 A B
split + f2 b2 A B
split + f3 b3 A B
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split - A B over
inhook A B C
tuck + b0
tuck + b1
tuck + b2
tuck + b3
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3 A B
split - f2 b2 A B
split - f1 b1 A B
split - f0 b0 A B
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split + A B C over
inhook A B C
tuck - b3
tuck - b2
tuck - b1
tuck - b0
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0 A B C
split + f1 b1 A B C
split + f2 b2 A B C
split + f3 b3 A B C
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split - A B C over
inhook A B C
tuck + b0
tuck + b1
tuck + b2
tuck + b3
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3 A B C
split - f2 b2 A B C
split - f1 b1 A B C
split - f0 b0 A B C
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split +  over A
inhook A B C
tuck - b3 A
tuck - b2 A
tuck - b1 A
tuck - b0 A
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0
split + f1 b1
split + f2 b2
split + f3 b3
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split -  over A
inhook A B C
tuck + b0 A
tuck + b1 A
tuck + b2 A
tuck + b3 A
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3
split - f2 b2
split - f1 b1
split - f0 b0
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split + A over A
inhook A B C
tuck - b3 A
tuck - b2 A
tuck - b1 A
tuck - b0 A
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0 A
split + f1 b1 A
split + f2 b2 A
split + f3 b3 A
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split - A over A
inhook A B C
tuck + b0 A
tuck + b1 A
tuck + b2 A
tuck + b3 A
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3 A
split - f2 b2 A
split - f1 b1 A
split - f0 b0 A
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split + A B over A
inhook A B C
tuck - b3 A
tuck - b2 A
tuck - b1 A
tuck - b0 A
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0 A B
split + f1 b1 A B
split + f2 b2 A B
split + f3 b3 A B
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split - A B over A
inhook A B C
tuck + b0 A
tuck + b1 A
tuck + b2 A
tuck + b3 A
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3 A B
split - f2 b2 A B
split - f1 b1 A B
split - f0 b0 A B
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split + A B C over A
inhook A B C
tuck - b3 A
tuck - b2 A
tuck - b1 A
tuck - b0 A
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0 A B C
split + f1 b1 A B C
split + f2 b2 A B C
split + f3 b3 A B C
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split - A B C over A
inhook A B C
tuck + b0 A
tuck + b1 A
tuck + b2 A
tuck + b3 A
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3 A B C
split - f2 b2 A B C
split - f1 b1 A B C
split - f0 b0 A B C
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split +  over A B
inhook A B C
tuck - b3 A B
tuck - b2 A B
tuck - b1 A B
tuck - b0 A B
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0
split + f1 b1
split + f2 b2
split + f3 b3
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split -  over A B
inhook A B C
tuck + b0 A B
tuck + b1 A B
tuck + b2 A B
tuck + b3 A B
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3
split - f2 b2
split - f1 b1
split - f0 b0
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split + A over A B
inhook A B C
tuck - b3 A B
tuck - b2 A B
tuck - b1 A B
tuck - b0 A B
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0 A
split + f1 b1 A
split + f2 b2 A
split + f3 b3 A
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split - A over A B
inhook A B C
tuck + b0 A B
tuck + b1 A B
tuck + b2 A B
tuck + b3 A B
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3 A
split - f2 b2 A
split - f1 b1 A
split - f0 b0 A
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split + A B over A B
inhook A B C
tuck - b3 A B
tuck - b2 A B
tuck - b1 A B
tuck - b0 A B
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0 A B
split + f1 b1 A B
split + f2 b2 A B
split + f3 b3 A B
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split - A B over A B
inhook A B C
tuck + b0 A B
tuck + b1 A B
tuck + b2 A B
tuck + b3 A B
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3 A B
split - f2 b2 A B
split - f1 b1 A B
split - f0 b0 A B
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split + A B C over A B
inhook A B C
tuck - b3 A B
tuck - b2 A B
tuck - b1 A B
tuck - b0 A B
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0 A B C
split + f1 b1 A B C
split + f2 b2 A B C
split + f3 b3 A B C
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split - A B C over A B
inhook A B C
tuck + b0 A B
tuck + b1 A B
tuck + b2 A B
tuck + b3 A B
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3 A B C
split - f2 b2 A B C
split - f1 b1 A B C
split - f0 b0 A B C
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split +  over A B C
inhook A B C
tuck - b3 A B C
tuck - b2 A B C
tuck - b1 A B C
tuck - b0 A B C
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0
split + f1 b1
split + f2 b2
split + f3 b3
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split -  over A B C
inhook A B C
tuck + b0 A B C
tuck + b1 A B C
tuck + b2 A B C
tuck + b3 A B C
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3
split - f2 b2
split - f1 b1
split - f0 b0
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split + A over A B C
inhook A B C
tuck - b3 A B C
tuck - b2 A B C
tuck - b1 A B C
tuck - b0 A B C
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0 A
split + f1 b1 A
split + f2 b2 A
split + f3 b3 A
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split - A over A B C
inhook A B C
tuck + b0 A B C
tuck + b1 A B C
tuck + b2 A B C
tuck + b3 A B C
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3 A
split - f2 b2 A
split - f1 b1 A
split - f0 b0 A
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split + A B over A B C
inhook A B C
tuck - b3 A B C
tuck - b2 A B C
tuck - b1 A B C
tuck - b0 A B C
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0 A B
split + f1 b1 A B
split + f2 b2 A B
split + f3 b3 A B
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split - A B over A B C
inhook A B C
tuck + b0 A B C
tuck + b1 A B C
tuck + b2 A B C
tuck + b3 A B C
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3 A B
split - f2 b2 A B
split - f1 b1 A B
split - f0 b0 A B
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split + A B C over A B C
inhook A B C
tuck - b3 A B C
tuck - b2 A B C
tuck - b1 A B C
tuck - b0 A B C
outhook A B C
inhook A B C
tuck - f3
tuck - f2 A
tuck - f1 A B
tuck - f0 A B C
split + f0 b0 A B C
split + f1 b1 A B C
split + f2 b2 A B C
split + f3 b3 A B C
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C

; split - A B C over A B C
inhook A B C
tuck + b0 A B C
tuck + b1 A B C
tuck + b2 A B C
tuck + b3 A B C
outhook A B C
inhook A B C
tuck + f0
tuck + f1 A
tuck + f2 A B
tuck + f3 A B C
split - f3 b3 A B C
split - f2 b2 A B C
split - f1 b1 A B C
split - f0 b0 A B C
drop f0
drop f1
drop f2
drop f3
drop b0
drop b1
drop b2
drop b3
outhook A B C
</code></pre>

<div id="dropTarget"></div>

<script src="parseKnitout.js"></script>
<script src="CellMachine.js"></script>
<script src="VectorTiles.js"></script>
<script src="show-knitout.js"></script>

<script>

    function spin() {
        document.getElementById("spinner").style.visibility = 'visible';
    }

function noSpin() {
        document.getElementById("spinner").style.visibility = 'hidden';
}

var code = document.getElementById('code1');
var show = document.getElementById('show1');

show.showKnitout.parse(code.innerText);

function readFile(file) {

	var oldSize = 0;
	var oldCheck = 0;
	var oldText = null;

        function spinPoll() {
            spin();
            setTimeout(function() {
                pollFile();
                setTimeout(noSpin, 50);
            }, 50);
        }
	function pollFile() {
                spin();
		//generate new data:
		let reader = new FileReader();
		reader.onload = function(){
			if (reader.result !== oldText) {
				oldText = reader.result;
				console.log("parsing...");
				show.showKnitout.parse(reader.result);
				console.log("done parsing.");
			}

			//poll again:
			readFile.pollTimeout = window.setTimeout(spinPoll, 5000);
		};

                reader.onerror = function() {
                    console.log("ERROR")
                    console.log(reader.error)
                };

		console.log("polling " + file.name);
		reader.readAsText(file);
                console.log("Attempting to read file: '" + file.name + "'");
	}
	if ('pollTimeout' in readFile) {
		window.clearTimeout(readFile.pollTimeout);
		delete readFile.pollTimeout;
	}
	spinPoll();

}

var dropTarget = document.getElementById("dropTarget");
//dragging into the window also loads files:
dropTarget.addEventListener('dragover', function(evt){
	dropTarget.classList.add("active");
	evt.preventDefault();
	return false;
});
dropTarget.addEventListener('dragleave', function(evt){
	dropTarget.classList.remove("active");
	evt.preventDefault();
	return false;
});
dropTarget.addEventListener('drop', function(evt){
	dropTarget.classList.remove("active");
	try {
		readFile(evt.dataTransfer.files[0]);
	} catch (e) {
		console.log(e);
	}
	evt.preventDefault();
	return false;
});

//dragging into the window shows the target:
document.addEventListener('dragover', function(evt){
	dropTarget.classList.add("active");
	evt.preventDefault();
	return false;
});

var file = document.getElementById("file");
file.addEventListener('change', function(evt){
	try {
		readFile(file.files[0]);
	} catch (e) {
		console.log(e);
	}
	evt.preventDefault();
	return false;
});
</script>

</body>
